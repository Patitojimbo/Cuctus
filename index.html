<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cactus Clicker Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5deb3; /* Desert sand color */
            font-family: Arial, sans-serif;
            overflow: hidden;
            touch-action: manipulation; /* Prevents double-tap zoom on mobile */
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #cactus {
            width: 40vmin; /* Responsive size based on viewport */
            max-width: 250px;
            height: 48vmin; /* Maintain aspect ratio */
            max-height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }
        
        #cactus img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        #cactus:active {
            transform: scale(0.95);
        }
        
        #score-container {
            position: absolute;
            top: 5vh;
            left: 0;
            width: 100%;
            text-align: center;
        }
        
        #score {
            font-size: clamp(18px, 5vmin, 24px); /* Responsive font size */
            font-weight: bold;
            color: #2e8b57; /* Sea green */
        }
        
        #click-effect {
            position: absolute;
            font-size: clamp(18px, 5vmin, 24px); /* Responsive font size */
            font-weight: bold;
            color: #ff4500; /* Orange-red */
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
        }
        
        .instructions {
            margin-top: 4vh;
            text-align: center;
            color: #556b2f; /* Dark olive green */
            font-size: clamp(14px, 3vmin, 16px); /* Responsive font size */
        }
        
        #shop-button {
            position: absolute;
            bottom: 5vh;
            right: 5vw;
            padding: 2vmin 4vmin;
            min-width: 80px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: clamp(14px, 3vmin, 16px); /* Responsive font size */
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #shop-button:hover {
            background-color: #45a049;
        }
        
        #shop-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #shop-button.pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }
        
        /* Media Queries for different screen sizes */
        @media (max-width: 768px) {
            #cactus {
                width: 35vmin;
                height: 42vmin;
            }
            
            .instructions {
                margin-top: 3vh;
                font-size: clamp(12px, 2.5vmin, 14px);
            }
        }
        
        @media (max-width: 480px) {
            #cactus {
                width: 55vmin;
                height: 66vmin;
                max-width: none;
                max-height: none;
            }
            
            #shop-button {
                top: 15vh;
                right: 3vw;
                padding: 1.5vmin 3vmin;
                position: fixed;
            }
            
            .shop-content {
                padding: 4vmin;
                width: 85%;
            }
        }
        
        @media (max-height: 500px) and (orientation: landscape) {
            #game-container {
                flex-direction: row;
                justify-content: space-around;
                align-items: center;
                padding: 0 5vw;
            }
            
            #cactus {
                width: 25vmin;
                height: 30vmin;
            }
            
            #score-container {
                position: relative;
                top: 0;
                width: auto;
                margin-right: 5vw;
            }
            
            .instructions {
                display: none; /* Hide instructions on very small height */
            }
            
            #shop-button {
                position: relative;
                bottom: auto;
                right: auto;
                margin-left: 5vw;
            }
        }
        
        #shop-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto; /* Allow scrolling on small screens */
        }
        
        .shop-content {
            background-color: #f9f9f9;
            padding: 5vmin;
            border-radius: 10px;
            max-width: 90%;
            width: min(400px, 90%);
            text-align: center;
            margin: auto; /* Center on all screens */
            max-height: 90vh; /* Limit height on small screens */
            overflow-y: auto; /* Allow scrolling if content is too tall */
        }
        
        .shop-item {
            margin: 3vmin 0;
            padding: 3vmin;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        
        .shop-item h3 {
            font-size: clamp(16px, 4vmin, 20px);
            margin-top: 0;
        }
        
        .shop-item p {
            font-size: clamp(12px, 3vmin, 16px);
        }
        
        .shop-item button {
            padding: 2vmin 3vmin;
            min-width: 60px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 2vmin;
            font-size: clamp(12px, 3vmin, 14px);
        }
        
        .shop-item button:hover {
            background-color: #45a049;
        }
        
        .shop-item button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .close-button {
            position: absolute;
            top: 2vmin;
            right: 2vmin;
            font-size: clamp(24px, 6vmin, 32px);
            cursor: pointer;
            color: #555;
            z-index: 1001; /* Ensure it's above other elements */
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="score-container">
            <div id="score">Score: 0</div>
        </div>
        
        <div id="cactus">
            <img src="rainbow-cactus.svg" alt="Clickable Cactus">
        </div>
        
        <div id="click-effect">+1</div>
        
        <div class="instructions">
            <p>Click the cactus as many times as you can!</p>
        </div>
        
        <button id="shop-button">Shop</button>
    </div>
    
    <div id="shop-modal">
        <div class="shop-content">
            <span class="close-button">&times;</span>
            <h2>Cactus Shop</h2>
            <div class="shop-item" id="rainbow-cactus-item">
                <h3>Rainbow Cactus</h3>
                <p>A magical rainbow cactus that gives you x2 clicks!</p>
                <p>Cost: 1000 clicks</p>
                <button id="buy-rainbow-cactus">Buy</button>
                <button id="select-rainbow-cactus" style="display: none; margin-left: 10px; background-color: #9c27b0;">Select</button>
            </div>
            <div class="shop-item" id="golden-cactus-item">
                <h3>Golden Cactus</h3>
                <p>A shiny golden cactus that gives you random points between 1-5 per click!</p>
                <p>Cost: 2500 clicks</p>
                <button id="buy-golden-cactus">Buy</button>
                <button id="select-golden-cactus" style="display: none; margin-left: 10px; background-color: #9c27b0;">Select</button>
            </div>
            <div class="shop-item" id="minecraft-cactus-item">
                <h3>Minecraft Cactus</h3>
                <p>A special cactus that automatically stings itself every 15 seconds, adding +2 points every 300ms for 4 seconds!</p>
                <p>Cost: 5000 clicks</p>
                <button id="buy-minecraft-cactus">Buy</button>
                <button id="select-minecraft-cactus" style="display: none; margin-left: 10px; background-color: #9c27b0;">Select</button>
            </div>
            <div class="shop-item" id="spike-cactus-item">
                <h3>Spike from Brawl Stars</h3>
                <p>A special cactus that releases a balloon every 15 seconds. Hit the balloon within 2 seconds for random points (100-1000)!</p>
                <p>Cost: 15000 clicks</p>
                <button id="buy-spike-cactus">Buy</button>
                <button id="select-spike-cactus" style="display: none; margin-left: 10px; background-color: #9c27b0;">Select</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cactus = document.getElementById('cactus');
            const scoreElement = document.getElementById('score');
            const shopButton = document.getElementById('shop-button');
            const shopModal = document.getElementById('shop-modal');
            const closeButton = document.querySelector('.close-button');
            const buyRainbowCactusButton = document.getElementById('buy-rainbow-cactus');
            const buyGoldenCactusButton = document.getElementById('buy-golden-cactus');
            const cactusImage = document.querySelector('#cactus img');
            
            // Game state variables
            let score = localStorage.getItem('cactusScore') ? parseInt(localStorage.getItem('cactusScore')) : 0;
            let clickMultiplier = localStorage.getItem('clickMultiplier') ? parseInt(localStorage.getItem('clickMultiplier')) : 1;
            let hasRainbowCactus = localStorage.getItem('hasRainbowCactus') === 'true';
            let hasGoldenCactus = localStorage.getItem('hasGoldenCactus') === 'true';
            let hasMinecraftCactus = localStorage.getItem('hasMinecraftCactus') === 'true';
            let hasSpikeCactus = localStorage.getItem('hasSpikeCactus') === 'true';
            
            // Track which cactus is currently active
            let activeCactus = localStorage.getItem('activeCactus') || 'default';
            const selectRainbowCactusButton = document.getElementById('select-rainbow-cactus');
            const selectGoldenCactusButton = document.getElementById('select-golden-cactus');
            const selectMinecraftCactusButton = document.getElementById('select-minecraft-cactus');
            const selectSpikeCactusButton = document.getElementById('select-spike-cactus');
            
            // Minecraft cactus variables
            let minecraftCactusInterval = null;
            let minecraftCactusStingingInterval = null;
            
            // Spike cactus variables
            let spikeCactusInterval = null;
            let balloonElement = null;
            
            // Update UI based on saved state
            scoreElement.textContent = 'Score: ' + score;
            updateShopButtonState();
            
            // Apply the active cactus based on saved preference
            if (activeCactus === 'rainbow' && hasRainbowCactus) {
                applyRainbowCactus();
                buyRainbowCactusButton.disabled = true;
                buyRainbowCactusButton.textContent = 'Purchased';
            } else if (activeCactus === 'golden' && hasGoldenCactus) {
                applyGoldenCactus();
                buyGoldenCactusButton.disabled = true;
                buyGoldenCactusButton.textContent = 'Purchased';
            } else if (activeCactus === 'minecraft' && hasMinecraftCactus) {
                applyMinecraftCactus();
                document.getElementById('buy-minecraft-cactus').disabled = true;
                document.getElementById('buy-minecraft-cactus').textContent = 'Purchased';
            } else if (activeCactus === 'spike' && hasSpikeCactus) {
                applySpikeCactus();
                document.getElementById('buy-spike-cactus').disabled = true;
                document.getElementById('buy-spike-cactus').textContent = 'Purchased';
            } else {
                // Default cactus (no special effects)
                resetToDefaultCactus();
                activeCactus = 'default';
                localStorage.setItem('activeCactus', activeCactus);
            }
            
            // Function to reset to default cactus
            function resetToDefaultCactus() {
                // Clear any intervals
                if (minecraftCactusInterval) {
                    clearInterval(minecraftCactusInterval);
                    minecraftCactusInterval = null;
                }
                if (minecraftCactusStingingInterval) {
                    clearInterval(minecraftCactusStingingInterval);
                    minecraftCactusStingingInterval = null;
                }
                if (spikeCactusInterval) {
                    clearInterval(spikeCactusInterval);
                    spikeCactusInterval = null;
                }
                
                // Remove any balloon element
                if (balloonElement) {
                    balloonElement.remove();
                    balloonElement = null;
                }
                
                // Reset cactus image
                cactusImage.src = 'cactus.svg';
                cactusImage.style.filter = 'none';
                
                // Reset click multiplier
                clickMultiplier = 1;
                localStorage.setItem('clickMultiplier', clickMultiplier);
            }
            
            // Create click effect element
            function createClickEffect(x, y, points) {
                const effect = document.createElement('div');
                // Use the points parameter if provided, otherwise use clickMultiplier
                effect.textContent = '+' + (points !== undefined ? points : clickMultiplier);
                effect.style.position = 'absolute';
                effect.style.left = x + 'px';
                effect.style.top = y + 'px';
                effect.style.color = hasRainbowCactus ? getRandomColor() : '#ff4500';
                effect.style.fontSize = '24px';
                effect.style.fontWeight = 'bold';
                effect.style.pointerEvents = 'none';
                effect.style.opacity = '1';
                effect.style.transform = 'translateY(0)';
                effect.style.transition = 'opacity 0.8s, transform 0.8s';
                
                document.getElementById('game-container').appendChild(effect);
                
                // Animate the effect
                setTimeout(() => {
                    effect.style.opacity = '0';
                    effect.style.transform = 'translateY(-30px)';
                }, 50);
                
                // Remove the element after animation
                setTimeout(() => {
                    effect.remove();
                }, 800);
            }
            
            // Generate random color for rainbow effects
            function getRandomColor() {
                const letters = '0123456789ABCDEF';
                let color = '#';
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
            
            // Apply rainbow cactus effect
            function applyRainbowCactus() {
                // Create rainbow SVG filter if it doesn't exist
                if (!document.getElementById('rainbow-filter')) {
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('width', '0');
                    svg.setAttribute('height', '0');
                    svg.style.position = 'absolute';
                    svg.innerHTML = `
                        <defs>
                            <filter id="rainbow-filter">
                                <feColorMatrix type="hueRotate" values="0">
                                    <animate attributeName="values" from="0" to="360" dur="2s" repeatCount="indefinite" />
                                </feColorMatrix>
                            </filter>
                        </defs>
                    `;
                    document.body.appendChild(svg);
                }
                
                // Apply filter to cactus
                cactusImage.style.filter = 'url(#rainbow-filter)';
                clickMultiplier = 2;
                localStorage.setItem('clickMultiplier', clickMultiplier);
            }
            
            // Apply golden cactus effect
            function applyGoldenCactus() {
                // Change cactus image to golden cactus
                cactusImage.src = 'golden-cactus.svg';
                // Reset click multiplier to 1 since we'll use random points instead
                clickMultiplier = 1;
                localStorage.setItem('clickMultiplier', clickMultiplier);
            }
            
            // Apply minecraft cactus effect
            function applyMinecraftCactus() {
                // Change cactus image to minecraft cactus
                cactusImage.src = 'minecraft-cactus.svg';
                
                // Set up the auto-generation interval (every 15 seconds)
                minecraftCactusInterval = setInterval(() => {
                    // Start the stinging animation
                    startMinecraftCactusStinging();
                }, 15000);
            }
            
            // Apply spike cactus effect
            function applySpikeCactus() {
                // Change cactus image to spike cactus
                cactusImage.src = 'spike-cactus.svg';
                
                // Set up the balloon release interval (every 15 seconds)
                spikeCactusInterval = setInterval(() => {
                    // Release a balloon
                    releaseBalloon();
                }, 15000);
            }
            
            // Release a balloon from Spike cactus
            function releaseBalloon() {
                // Remove any existing balloon
                if (balloonElement) {
                    balloonElement.remove();
                }
                
                // Create a new balloon element
                balloonElement = document.createElement('div');
                balloonElement.style.position = 'absolute';
                balloonElement.style.width = '60px';
                balloonElement.style.height = '80px';
                balloonElement.style.cursor = 'pointer';
                balloonElement.style.transition = 'transform 0.3s, top 2s';
                
                // Add balloon image
                const balloonImg = document.createElement('img');
                balloonImg.src = 'balloon.svg';
                balloonImg.style.width = '100%';
                balloonImg.style.height = '100%';
                balloonElement.appendChild(balloonImg);
                
                // Position the balloon near the cactus
                const cactusRect = cactus.getBoundingClientRect();
                balloonElement.style.left = (cactusRect.left + cactusRect.width / 2 - 30) + 'px';
                balloonElement.style.top = (cactusRect.top - 20) + 'px';
                
                // Add to the game container
                document.getElementById('game-container').appendChild(balloonElement);
                
                // Make the balloon float up
                setTimeout(() => {
                    balloonElement.style.top = (cactusRect.top - 200) + 'px';
                }, 50);
                
                // Function to handle balloon interaction (click or touch)
                function handleBalloonInteraction(event) {
                    // Prevent default behavior for touch events
                    if (event.type === 'touchstart') {
                        event.preventDefault();
                    }
                    
                    // Generate random points between 100 and 1000
                    const points = Math.floor(Math.random() * 901) + 100;
                    
                    // Add points to score
                    score += points;
                    scoreElement.textContent = 'Score: ' + score;
                    
                    // Save score to localStorage
                    localStorage.setItem('cactusScore', score);
                    
                    // Create click effect at balloon position
                    const balloonRect = balloonElement.getBoundingClientRect();
                    createClickEffect(balloonRect.left + balloonRect.width / 2, balloonRect.top + balloonRect.height / 2, points);
                    
                    // Remove the balloon
                    balloonElement.remove();
                    balloonElement = null;
                    
                    // Update shop button state
                    updateShopButtonState();
                }
                
                // Add click event to the balloon for desktop
                balloonElement.addEventListener('click', handleBalloonInteraction);
                
                // Add touch event to the balloon for mobile
                balloonElement.addEventListener('touchstart', handleBalloonInteraction, { passive: false });
                
                // Remove the balloon after 2 seconds if not clicked
                setTimeout(() => {
                    if (balloonElement) {
                        balloonElement.remove();
                        balloonElement = null;
                    }
                }, 2000);
            }
            
            // Start the minecraft cactus stinging animation and point generation
            function startMinecraftCactusStinging() {
                // Visual feedback - shake the cactus
                cactus.style.transform = 'scale(0.95) rotate(-5deg)';
                setTimeout(() => {
                    cactus.style.transform = 'scale(0.97) rotate(5deg)';
                }, 200);
                setTimeout(() => {
                    cactus.style.transform = 'scale(1) rotate(0)';
                }, 400);
                
                // Create a visual effect at the center of the cactus
                const cactusRect = cactus.getBoundingClientRect();
                const centerX = cactusRect.left + cactusRect.width / 2;
                const centerY = cactusRect.top + cactusRect.height / 2;
                
                // Start adding points every 300ms for 4 seconds
                let stingingDuration = 0;
                minecraftCactusStingingInterval = setInterval(() => {
                    // Add 2 points
                    score += 2;
                    scoreElement.textContent = 'Score: ' + score;
                    
                    // Save score to localStorage
                    localStorage.setItem('cactusScore', score);
                    
                    // Create visual effect at the exact center of the cactus (no random offset)
                    createClickEffect(centerX, centerY, 2);
                    
                    // Increase duration counter
                    stingingDuration += 300;
                    
                    // Stop after 4 seconds (4000ms)
                    if (stingingDuration >= 4000) {
                        clearInterval(minecraftCactusStingingInterval);
                    }
                }, 300);
                
                // Update shop button state
                updateShopButtonState();
            }
            
            // Update shop button state based on score
            function updateShopButtonState() {
                if ((score >= 1000 && !hasRainbowCactus) || 
                    (score >= 2500 && !hasGoldenCactus) || 
                    (score >= 5000 && !hasMinecraftCactus) ||
                    (score >= 15000 && !hasSpikeCactus)) {
                    shopButton.classList.add('pulse');
                } else {
                    shopButton.classList.remove('pulse');
                }
            }
            
            // Function to handle cactus interaction (click or touch)
            function handleCactusInteraction(event) {
                // Prevent default behavior to avoid double-tap zoom on mobile
                event.preventDefault();
                
                // Check which cactus is active to determine points
                let pointsToAdd = clickMultiplier;
                
                if (hasGoldenCactus && activeCactus === 'golden') {
                    // Generate random points between 1 and 5 for golden cactus
                    pointsToAdd = Math.floor(Math.random() * 5) + 1;
                } else if (hasMinecraftCactus && activeCactus === 'minecraft') {
                    // Add 2 points for minecraft cactus
                    pointsToAdd = 2;
                }
                
                // Increase score
                score += pointsToAdd;
                scoreElement.textContent = 'Score: ' + score;
                
                // Save score to localStorage
                localStorage.setItem('cactusScore', score);
                
                // Get the position for the click effect
                let posX, posY;
                if (event.type === 'touchstart') {
                    // For touch events, use the first touch point
                    const touch = event.touches[0];
                    posX = touch.clientX;
                    posY = touch.clientY;
                } else {
                    // For mouse events
                    posX = event.clientX;
                    posY = event.clientY;
                }
                
                // Create click effect at the interaction position
                createClickEffect(posX, posY, pointsToAdd);
                
                // Add a little shake effect
                cactus.style.transform = 'scale(0.95) rotate(5deg)';
                setTimeout(() => {
                    cactus.style.transform = 'scale(1) rotate(0)';
                }, 100);
                
                // Update shop button state
                updateShopButtonState();
            }
            
            // Handle cactus click for desktop
            cactus.addEventListener('click', handleCactusInteraction);
            
            // Handle cactus touch for mobile
            cactus.addEventListener('touchstart', handleCactusInteraction, { passive: false });
            
            // Shop button click handler
            shopButton.addEventListener('click', function() {
                shopModal.style.display = 'flex';
                
                // Update rainbow cactus button state
                if (score >= 1000 && !hasRainbowCactus) {
                    buyRainbowCactusButton.disabled = false;
                    selectRainbowCactusButton.style.display = 'none';
                } else if (hasRainbowCactus) {
                    buyRainbowCactusButton.disabled = true;
                    buyRainbowCactusButton.textContent = 'Purchased';
                    selectRainbowCactusButton.style.display = 'inline-block';
                    
                    // Highlight if active
                    if (activeCactus === 'rainbow') {
                        selectRainbowCactusButton.textContent = 'Active';
                        selectRainbowCactusButton.style.backgroundColor = '#4CAF50';
                    } else {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                } else {
                    buyRainbowCactusButton.disabled = true;
                    selectRainbowCactusButton.style.display = 'none';
                }
                
                // Update golden cactus button state
                if (score >= 2500 && !hasGoldenCactus) {
                    buyGoldenCactusButton.disabled = false;
                    selectGoldenCactusButton.style.display = 'none';
                } else if (hasGoldenCactus) {
                    buyGoldenCactusButton.disabled = true;
                    buyGoldenCactusButton.textContent = 'Purchased';
                    selectGoldenCactusButton.style.display = 'inline-block';
                    
                    // Highlight if active
                    if (activeCactus === 'golden') {
                        selectGoldenCactusButton.textContent = 'Active';
                        selectGoldenCactusButton.style.backgroundColor = '#4CAF50';
                    } else {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                } else {
                    buyGoldenCactusButton.disabled = true;
                    selectGoldenCactusButton.style.display = 'none';
                }
                
                // Update minecraft cactus button state
                const buyMinecraftCactusButton = document.getElementById('buy-minecraft-cactus');
                if (score >= 5000 && !hasMinecraftCactus) {
                    buyMinecraftCactusButton.disabled = false;
                    selectMinecraftCactusButton.style.display = 'none';
                } else if (hasMinecraftCactus) {
                    buyMinecraftCactusButton.disabled = true;
                    buyMinecraftCactusButton.textContent = 'Purchased';
                    selectMinecraftCactusButton.style.display = 'inline-block';
                    
                    // Highlight if active
                    if (activeCactus === 'minecraft') {
                        selectMinecraftCactusButton.textContent = 'Active';
                        selectMinecraftCactusButton.style.backgroundColor = '#4CAF50';
                    } else {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                } else {
                    buyMinecraftCactusButton.disabled = true;
                    selectMinecraftCactusButton.style.display = 'none';
                }
                
                // Update spike cactus button state
                const buySpikeCactusButton = document.getElementById('buy-spike-cactus');
                if (score >= 15000 && !hasSpikeCactus) {
                    buySpikeCactusButton.disabled = false;
                    selectSpikeCactusButton.style.display = 'none';
                } else if (hasSpikeCactus) {
                    buySpikeCactusButton.disabled = true;
                    buySpikeCactusButton.textContent = 'Purchased';
                    selectSpikeCactusButton.style.display = 'inline-block';
                    
                    // Highlight if active
                    if (activeCactus === 'spike') {
                        selectSpikeCactusButton.textContent = 'Active';
                        selectSpikeCactusButton.style.backgroundColor = '#4CAF50';
                    } else {
                        selectSpikeCactusButton.textContent = 'Select';
                        selectSpikeCactusButton.style.backgroundColor = '#9c27b0';
                    }
                } else {
                    buySpikeCactusButton.disabled = true;
                    selectSpikeCactusButton.style.display = 'none';
                }
            });
            
            // Close button click handler
            closeButton.addEventListener('click', function() {
                shopModal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === shopModal) {
                    shopModal.style.display = 'none';
                }
            });
            
            // Buy rainbow cactus button click handler
            buyRainbowCactusButton.addEventListener('click', function() {
                if (score >= 1000 && !hasRainbowCactus) {
                    score -= 1000;
                    hasRainbowCactus = true;
                    
                    // Reset current cactus and apply rainbow effect
                    resetToDefaultCactus();
                    applyRainbowCactus();
                    activeCactus = 'rainbow';
                    
                    // Update UI
                    scoreElement.textContent = 'Score: ' + score;
                    buyRainbowCactusButton.disabled = true;
                    buyRainbowCactusButton.textContent = 'Purchased';
                    selectRainbowCactusButton.style.display = 'inline-block';
                    selectRainbowCactusButton.textContent = 'Active';
                    selectRainbowCactusButton.style.backgroundColor = '#4CAF50';
                    
                    // Update other selection buttons if they exist
                    if (hasGoldenCactus) {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Save state
                    localStorage.setItem('cactusScore', score);
                    localStorage.setItem('hasRainbowCactus', true);
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update shop button state
                    updateShopButtonState();
                }
            });
            
            // Buy golden cactus button click handler
            buyGoldenCactusButton.addEventListener('click', function() {
                if (score >= 2500 && !hasGoldenCactus) {
                    score -= 2500;
                    hasGoldenCactus = true;
                    
                    // Reset current cactus and apply golden cactus effect
                    resetToDefaultCactus();
                    applyGoldenCactus();
                    activeCactus = 'golden';
                    
                    // Update UI
                    scoreElement.textContent = 'Score: ' + score;
                    buyGoldenCactusButton.disabled = true;
                    buyGoldenCactusButton.textContent = 'Purchased';
                    selectGoldenCactusButton.style.display = 'inline-block';
                    selectGoldenCactusButton.textContent = 'Active';
                    selectGoldenCactusButton.style.backgroundColor = '#4CAF50';
                    
                    // Update other selection buttons if they exist
                    if (hasRainbowCactus) {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Save state
                    localStorage.setItem('cactusScore', score);
                    localStorage.setItem('hasGoldenCactus', true);
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update shop button state
                    updateShopButtonState();
                }
            });
            
            // Buy minecraft cactus button click handler
            document.getElementById('buy-minecraft-cactus').addEventListener('click', function() {
                if (score >= 5000 && !hasMinecraftCactus) {
                    score -= 5000;
                    hasMinecraftCactus = true;
                    
                    // Reset current cactus and apply minecraft cactus effect
                    resetToDefaultCactus();
                    applyMinecraftCactus();
                    activeCactus = 'minecraft';
                    
                    // Update UI
                    scoreElement.textContent = 'Score: ' + score;
                    this.disabled = true;
                    this.textContent = 'Purchased';
                    selectMinecraftCactusButton.style.display = 'inline-block';
                    selectMinecraftCactusButton.textContent = 'Active';
                    selectMinecraftCactusButton.style.backgroundColor = '#4CAF50';
                    
                    // Save state
                    localStorage.setItem('cactusScore', score);
                    localStorage.setItem('hasMinecraftCactus', true);
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update shop button state
                    updateShopButtonState();
                }
            });
            
            // Selection button event listeners
            selectRainbowCactusButton.addEventListener('click', function() {
                if (hasRainbowCactus && activeCactus !== 'rainbow') {
                    // Reset current cactus
                    resetToDefaultCactus();
                    
                    // Apply rainbow cactus
                    applyRainbowCactus();
                    activeCactus = 'rainbow';
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update UI
                    selectRainbowCactusButton.textContent = 'Active';
                    selectRainbowCactusButton.style.backgroundColor = '#4CAF50';
                    
                    if (hasGoldenCactus) {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Close the shop modal
                    shopModal.style.display = 'none';
                }
            });
            
            selectGoldenCactusButton.addEventListener('click', function() {
                if (hasGoldenCactus && activeCactus !== 'golden') {
                    // Reset current cactus
                    resetToDefaultCactus();
                    
                    // Apply golden cactus
                    applyGoldenCactus();
                    activeCactus = 'golden';
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update UI
                    selectGoldenCactusButton.textContent = 'Active';
                    selectGoldenCactusButton.style.backgroundColor = '#4CAF50';
                    
                    if (hasRainbowCactus) {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Close the shop modal
                    shopModal.style.display = 'none';
                }
            });
            
            selectMinecraftCactusButton.addEventListener('click', function() {
                if (hasMinecraftCactus && activeCactus !== 'minecraft') {
                    // Reset current cactus
                    resetToDefaultCactus();
                    
                    // Apply minecraft cactus
                    applyMinecraftCactus();
                    activeCactus = 'minecraft';
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update UI
                    selectMinecraftCactusButton.textContent = 'Active';
                    selectMinecraftCactusButton.style.backgroundColor = '#4CAF50';
                    
                    if (hasRainbowCactus) {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasGoldenCactus) {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasSpikeCactus) {
                        selectSpikeCactusButton.textContent = 'Select';
                        selectSpikeCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Close the shop modal
                    shopModal.style.display = 'none';
                }
            });
            
            // Buy spike cactus button click handler
            document.getElementById('buy-spike-cactus').addEventListener('click', function() {
                if (score >= 15000 && !hasSpikeCactus) {
                    score -= 15000;
                    hasSpikeCactus = true;
                    
                    // Reset current cactus and apply spike cactus effect
                    resetToDefaultCactus();
                    applySpikeCactus();
                    activeCactus = 'spike';
                    
                    // Update UI
                    scoreElement.textContent = 'Score: ' + score;
                    this.disabled = true;
                    this.textContent = 'Purchased';
                    selectSpikeCactusButton.style.display = 'inline-block';
                    selectSpikeCactusButton.textContent = 'Active';
                    selectSpikeCactusButton.style.backgroundColor = '#4CAF50';
                    
                    // Update other selection buttons
                    if (hasRainbowCactus) {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasGoldenCactus) {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Save state
                    localStorage.setItem('cactusScore', score);
                    localStorage.setItem('hasSpikeCactus', true);
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update shop button state
                    updateShopButtonState();
                }
            });
            
            // Select spike cactus button click handler
            selectSpikeCactusButton.addEventListener('click', function() {
                if (hasSpikeCactus && activeCactus !== 'spike') {
                    // Reset current cactus
                    resetToDefaultCactus();
                    
                    // Apply spike cactus
                    applySpikeCactus();
                    activeCactus = 'spike';
                    localStorage.setItem('activeCactus', activeCactus);
                    
                    // Update UI
                    selectSpikeCactusButton.textContent = 'Active';
                    selectSpikeCactusButton.style.backgroundColor = '#4CAF50';
                    
                    if (hasRainbowCactus) {
                        selectRainbowCactusButton.textContent = 'Select';
                        selectRainbowCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasGoldenCactus) {
                        selectGoldenCactusButton.textContent = 'Select';
                        selectGoldenCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    if (hasMinecraftCactus) {
                        selectMinecraftCactusButton.textContent = 'Select';
                        selectMinecraftCactusButton.style.backgroundColor = '#9c27b0';
                    }
                    
                    // Close the shop modal
                    shopModal.style.display = 'none';
                }
            });
        });
            
    </script>
</body>
</html>

